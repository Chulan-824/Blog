<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实现 JSX | 前端知识体系构建</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="楚岚博客">
    
    <link rel="preload" href="/Chulan-Blog/assets/css/0.styles.85c034c7.css" as="style"><link rel="preload" href="/Chulan-Blog/assets/js/app.24e2921c.js" as="script"><link rel="preload" href="/Chulan-Blog/assets/js/3.6afbbc29.js" as="script"><link rel="preload" href="/Chulan-Blog/assets/js/23.4224002f.js" as="script"><link rel="preload" href="/Chulan-Blog/assets/js/14.e3b5f6d1.js" as="script"><link rel="prefetch" href="/Chulan-Blog/assets/js/10.f7c63d6d.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/11.cd05cbe6.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/12.7e479571.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/13.e24a3187.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/15.9000139d.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/16.d16c6c70.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/17.afa85e50.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/18.77e742be.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/19.91a6d6d7.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/2.fc71eef6.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/20.3ea956c6.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/21.a6ae9912.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/22.216dfc2c.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/24.61864019.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/25.4d49ad54.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/26.2c7f2ee3.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/27.f9884b02.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/28.5d232169.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/29.a823c08f.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/30.0c145136.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/31.b13cd7fe.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/32.0e1037cb.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/33.ce6eeef5.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/34.c0457829.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/35.544b9df6.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/36.0e83a910.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/37.4dea549f.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/38.8a46bd76.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/39.0ae61311.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/4.b63fbcfe.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/40.0dee3b19.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/41.f1a8d02a.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/42.5c075ca1.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/43.a9cc6115.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/44.3f7e0a87.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/45.bf4140e4.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/46.8787e82b.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/47.48a83951.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/48.28cb7433.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/5.eafb203b.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/6.d8a91920.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/7.0e056339.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/8.dabbca2b.js"><link rel="prefetch" href="/Chulan-Blog/assets/js/9.c26bdc7e.js">
    <link rel="stylesheet" href="/Chulan-Blog/assets/css/0.styles.85c034c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Chulan-Blog/" class="home-link router-link-active"><!----> <span class="site-name">前端知识体系构建</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Chulan-Blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Chulan-Blog/js/base/inherit/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/Chulan-Blog/engineering/module/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/Chulan-Blog/hand-wirte-code/promise/" class="nav-link">
  手写代码
</a></div><div class="nav-item"><a href="/Chulan-Blog/Http/base/" class="nav-link">
  计算机网络
</a></div><div class="nav-item"><a href="/Chulan-Blog/Git/rebase/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/Chulan-Blog/react-design-principle/overview/know/" class="nav-link">
  React设计原理
</a></div><div class="nav-item"><a href="/Chulan-Blog/vue/concept/" class="nav-link">
  Vue设计与实现笔记
</a></div><div class="nav-item"><a href="/Chulan-Blog/project-optimization/chapter/" class="nav-link">
  项目优化
</a></div><div class="nav-item"><a href="/Chulan-Blog/english/elementary/noun/" class="nav-link">
  English Grammar
</a></div><div class="nav-item"><a href="https://github.com/Chulan-824" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Chulan-Blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Chulan-Blog/js/base/inherit/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/Chulan-Blog/engineering/module/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/Chulan-Blog/hand-wirte-code/promise/" class="nav-link">
  手写代码
</a></div><div class="nav-item"><a href="/Chulan-Blog/Http/base/" class="nav-link">
  计算机网络
</a></div><div class="nav-item"><a href="/Chulan-Blog/Git/rebase/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/Chulan-Blog/react-design-principle/overview/know/" class="nav-link">
  React设计原理
</a></div><div class="nav-item"><a href="/Chulan-Blog/vue/concept/" class="nav-link">
  Vue设计与实现笔记
</a></div><div class="nav-item"><a href="/Chulan-Blog/project-optimization/chapter/" class="nav-link">
  项目优化
</a></div><div class="nav-item"><a href="/Chulan-Blog/english/elementary/noun/" class="nav-link">
  English Grammar
</a></div><div class="nav-item"><a href="https://github.com/Chulan-824" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>理念篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Chulan-Blog/react-design-principle/overview/know.html" class="sidebar-link">初识前端框架</a></li><li><a href="/Chulan-Blog/react-design-principle/overview/react-concept.html" class="sidebar-link">React 理念</a></li><li><a href="/Chulan-Blog/react-design-principle/overview/render.html" class="sidebar-link">rendervscode</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>实现篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Chulan-Blog/react-design-principle/realize/init.html" class="sidebar-link">初始化项目</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/jsx.html" aria-current="page" class="active sidebar-link">实现 JSX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chulan-Blog/react-design-principle/realize/jsx.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/Chulan-Blog/react-design-principle/realize/jsx.html#jsx-转换是什么" class="sidebar-link">JSX 转换是什么</a></li><li class="sidebar-sub-header"><a href="/Chulan-Blog/react-design-principle/realize/jsx.html#实现-jsx-方法" class="sidebar-link">实现 JSX 方法</a></li><li class="sidebar-sub-header"><a href="/Chulan-Blog/react-design-principle/realize/jsx.html#实现-jsx-打包流程" class="sidebar-link">实现 JSX 打包流程</a></li></ul></li><li><a href="/Chulan-Blog/react-design-principle/realize/reconciler.html" class="sidebar-link">实现 Reconciler 架构</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/update.html" class="sidebar-link">状态更新机制</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/vite.html" class="sidebar-link">vite调试代码</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/hooks.html" class="sidebar-link">实现Hooks架构</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/jest.html" class="sidebar-link">jest 测试调试</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/explorationUpdate.html" class="sidebar-link">初探 Update 流程</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/event.html" class="sidebar-link">实现事件系统</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/diff.html" class="sidebar-link">diff算法</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/fragment.html" class="sidebar-link">Fragment</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/lane.html" class="sidebar-link">实现同步调度流程</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/useEffect.html" class="sidebar-link">实现 useEffect</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/noopRenderer.html" class="sidebar-link">实现noop-renderer</a></li><li><a href="/Chulan-Blog/react-design-principle/realize/concurrentUpdate.html" class="sidebar-link">并发更新原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="实现-jsx"><a href="#实现-jsx" class="header-anchor">#</a> 实现 JSX</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>React项目结构：</p> <ul><li>react（宿主环境无关的公用方法）</li> <li>react-reconciler（协调器的实现，宿主环境无关）</li> <li>各种宿主环境的包</li> <li>shared（公用辅助方法，宿主环境无关）</li></ul> <p>JSX 属于 react 包</p> <p>在 packages 目录下创建 react 文件夹，进入文件夹目录 初始化 package.json</p> <p>在 package.json 中 main 字段描述的是项目入口文件，对应的是 CommonJS 规范，由于我们打包规范选择的是 rollup，rollup 对应的是 ESM 规范，所以将 main 字段改为 module</p> <h2 id="jsx-转换是什么"><a href="#jsx-转换是什么" class="header-anchor">#</a> JSX 转换是什么</h2> <p><a href="https://babeljs.io/repl#?browsers=defaults&amp;build=&amp;builtIns=false&amp;corejs=3.6&amp;spec=false&amp;loose=false&amp;code_lz=DwEwlgbgfAjATAZmAenNIA&amp;debug=false&amp;forceAllTransforms=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=react%2Cstage-2&amp;prettier=false&amp;targets=&amp;version=7.19.5&amp;externalPlugins=&amp;assumptions=%7B%7D" target="_blank" rel="noopener noreferrer">JSX转换 playground<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <img src="/Chulan-Blog/assets/img/jsx-1.24dbde95.png" width="45%" class="zoom-custom-imgs"> <img src="/Chulan-Blog/assets/img/jsx-2.59d95ac6.png" width="45%" class="zoom-custom-imgs"> <p>在上述图中，左边输入一段 JSX 代码 经过 babel 编译转换成 右侧 React.createElement/_jsx 方法的调用，这个从左侧到右侧转变的过程叫做 JSX 的转换</p> <p>为什么两种模式下转换后的结果不一样呢？</p> <p>可以理解为在 react 17 版本之前，转换结果为 React.createElement，在 17 版本之后转换的结果为 _jsx</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> jsx <span class="token keyword">as</span> _jsx <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react/jsx-runtime&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/*#__PURE__*/</span><span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 或</span>
<span class="token comment">/*#__PURE__*/</span>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>包括两部分：</p> <ul><li>编译时</li> <li>运行时 jsx 方法或 React.createElement 方法的实现（包括dev、prod两个环境）</li></ul> <p>编译时由 babel 编译实现，我们来实现运行时，工作量包括：</p> <ul><li>实现jsx方法</li> <li>实现打包流程</li> <li>实现调试打包结果的环境</li></ul> <h2 id="实现-jsx-方法"><a href="#实现-jsx-方法" class="header-anchor">#</a> 实现 JSX 方法</h2> <ul><li>jsxDEV 方法（dev 环境）</li> <li>jsx 方法（prod 环境）</li> <li>React.createElement 方法</li></ul> <h2 id="实现-jsx-打包流程"><a href="#实现-jsx-打包流程" class="header-anchor">#</a> 实现 JSX 打包流程</h2> <p>对应上述两3方法，打包对应文件：</p> <ul><li><p>react/jsx-dev-runtime.js（dev环境）</p></li> <li><p>react/jsx-rumtime.js（prod环境）</p></li> <li><p>React</p></li></ul> <p>打包流程中需要安装的rollup plugin与node包：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> i -D -w rimraf rollup-plugin-generate-package-json rollup-plugin-typescript2 @rollup/plugin-commonjs
</code></pre></div><ul><li>rimraf 每次打包前删除文件（dist mac os 可以直接使用 rm -rf）</li> <li>rollup-plugin-generate-package-json  打包目录下自动生成 package.json 文件</li> <li>rollup-plugin-typescript2 打包过程中解析源码中的 typescript 语法</li> <li>@rollup/plugin-commonjs 解析 commanjs 规范</li></ul> <div class="sideTitle" data-v-d960f278><div class="title" data-v-d960f278>实现 JSX</div> <hr data-v-d960f278> <ul data-v-d960f278><li class="level-2" data-v-d960f278><a href="/Chulan-Blog/react-design-principle/realize/jsx.html#前言" data-v-d960f278>前言</a></li><li class="level-2" data-v-d960f278><a href="/Chulan-Blog/react-design-principle/realize/jsx.html#jsx-转换是什么" data-v-d960f278>JSX 转换是什么</a></li><li class="level-2" data-v-d960f278><a href="/Chulan-Blog/react-design-principle/realize/jsx.html#实现-jsx-方法" data-v-d960f278>实现 JSX 方法</a></li><li class="level-2" data-v-d960f278><a href="/Chulan-Blog/react-design-principle/realize/jsx.html#实现-jsx-打包流程" data-v-d960f278>实现 JSX 打包流程</a></li></ul></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Chulan-Blog/react-design-principle/realize/init.html" class="prev">
        初始化项目
      </a></span> <span class="next"><a href="/Chulan-Blog/react-design-principle/realize/reconciler.html">
        实现 Reconciler 架构
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Chulan-Blog/assets/js/app.24e2921c.js" defer></script><script src="/Chulan-Blog/assets/js/3.6afbbc29.js" defer></script><script src="/Chulan-Blog/assets/js/23.4224002f.js" defer></script><script src="/Chulan-Blog/assets/js/14.e3b5f6d1.js" defer></script>
  </body>
</html>
